# Extended Coverage Analysis {#extcoverage}

```{r setupappendix2, echo=FALSE, message=FALSE, warning=FALSE}
#--------- execute script of analysis
source("R/load_data.R")
source("R/esg_availability.R")
```

**Note:** this appendix includes technical information about the definitions of the coverage patterns
defined and identified in chapter \@ref(coverage), and may be useful for future research purposes.

In contrast to the tables in chapter \@ref(coverage), the tables in this appendix include many more ESG indicators ranked according to the measure of interest in each section.


## Country Coverage

```{r echo = FALSE}
tr_low <- 100  # number of countries. 
d3 <- d2  %>%
  mutate(max = max(mean),
         less = (mean < tr_low)) %>%
  summarise(sless = sum(less),
            max = mean(max),
            s   = sless/max)
d4 <- d2 %>% 
  arrange(mean)


```

Country coverage is defined as follows,  

$$
C_j = \frac{1}{y_f - y_i +1} \sum_{y = y_i}^{y_f}{n_{j}^{y}}
$$
Basically, it is the the average of the number of countries for which there is information available in indicator $j$ over the period $y_i-y_f$. In this case, $n_{j}^{y}$ is the number of countries with information available for indicator $j$ in year $y$. $y_i$ and  $y_f$ refer to the initial and final years of the analysis, which at the time of this publication they are `r first_year` `r last_year`, respectively.  

The table below is an expanded version of the table presented in section \@ref(consistently-low-coverage). Indicators are organized from the lowest to highest country coverage.

```{r dtlc, options}

  DT::datatable(d4, 
    colnames = c("Code", 
                 "Indicator", 
                 "Average of countries per year"),
    rownames = FALSE,
    filter = 'top', 
    width = '55%', 
    extensions = 'FixedColumns',
    options = list(pageLength = 5, 
                   autowidth = TRUE)
  ) %>% 
  DT::formatRound("mean" , 1)

```


## Improvement over time

In section \@ref(measurable-improvement) 

Most indicators have improved their coverage over time, but some of them show a remarkable improvement over time. Ranking indicators according to their improvement in country coverage is not straightforward. The coverage growth in many indicators is not consistent, fluctuating over time. In other cases, indicators that come from household surveys like the _Poverty headcounts_ or the _Gini index_ have shown a dramatic improvement in country coverage in the beginning of the 2000's. Thus, the table below shows the average growth of number of countries in each indicator penalized by the number of years in which they have no data at all. The higher the number in the third column the more consistent the indicator has been on increasing country coverage since 2000.

```{r agcbi}

  DT::datatable(lmdi,
    colnames = c("Code", 
                 "Indicator", "Avg. growth in coverage (penalized)", 
                 "No. of years with data"),
    rownames = FALSE,
    filter = 'top', 
    width = '55%', 
    extensions = 'FixedColumns',
    options = list(pageLength = 5, 
                   autowidth = TRUE)
  ) %>% 
  DT::formatRound("beta" , 1)
```



## Remain stable over time but with middle coverage

```{r fullystind}
fsi <- si %>% 
  filter(sd == 0) %>% 
  count() %>% 
  pull()


avfsi <- si %>% 
  filter(sd == 0) %>% 
  summarise(mm = mean(mean, na.rm = TRUE)) %>% 
  pull()

cfsi <- si %>% 
  filter(sd == 0) %>% 
  distinct(indicator) %>% 
  pull() %>% 
  add_and()

```

The country coverage of some indicators have remained relatively stable over time. Only `r fsi` indicators have not changed their country coverage over the period of analysis. In average, they cover `r round(avfsi, digit = 1)` countries.  These indicators are `r cfsi`. 

The table below shows how stable each indicator is over time and the average number of countries covered in each year.  

```{r dtsi}
si %>% 
  DT::datatable(
    colnames = c("Code", "Indicator", "Avg. of countries", "Standard Dev."),
    rownames = FALSE,
    filter = 'top', 
    width = '55%', 
    extensions = 'FixedColumns',
    options = list(pageLength = 5, 
                   autowidth = TRUE)
  ) %>% 
  DT::formatRound("mean" , 1) %>% 
  DT::formatRound("sd" , 2) 
```

## High coverage and sudden decline

Most recent value (MRV) of most indicators is two or more years old. However, some indicators with remarkable good coverage in the previous decade suddenly declined in the last five years. The table below shows the year in which the country coverage of each indicator plummeted and the number countries that were dropped. 

```{r sdd}
sdd %>% 
  DT::datatable(
    colnames = c("Code", "Indicator", "Year", "No. Countries dropped"),
    rownames = FALSE,
    filter = 'top', 
    width = '55%', 
    extensions = 'FixedColumns',
    options = list(pageLength = 5, 
                   autowidth = TRUE)
  ) 
```

## Intermittent and Lumpy coverage
Some indicators have intermittent coverage with excellent coverage in some years and no coverage at all in others. Other indicators are very lumpy in the sense that the number of countries covered varies from year to year. The table below tries to characterize all the indicators by their level of intermittentness and lumpiness. The *No. years covered* column shows the number of years with at least one country covered during the studied period. The *No. intervals with  no data* is the number of intervals in which no country is covered. The higher this number the more intermittent the indicator is. The *Avg. coverage interval*  indicates the number of years between successive years with country coverage. In other words, it indicates how often a year has information  or how intermittent the information of this indicator is. For examples, if the *Avg. coverage interval* is 2, it means that in average every two years this indicator covers at least one country. Finally, the *Lumpiness* index how lumpy an indicator is. The higher it is, the more lumpy its country coverage is. For more information on these measure see @syntetos_categorization_2005 and @williams_stock_1984. 

```{r icli}
ici %>% 
  DT::datatable(
    colnames = c("Code", "Indicator", "No. Years covered", "No. intervals with no data (intermittentness)", "Avg. coverage interval", "Lumpiness index"),
    rownames = FALSE,
    filter = 'top', 
    width = '55%', 
    extensions = 'FixedColumns',
    options = list(pageLength = 5,
                   autowidth = TRUE,
                   columnDefs = list(list(width = '380px', targets = 1),
                                     list(width = '35px', targets = c(2:5))
                                     )
                   )
  ) %>% 
  DT::formatRound(c("aci", "li") , 2) 

```

## high coverage 

```{r hcex}
hcex <- hc  %>% 
  slice(1:4) %>% 
  pull(input_name) %>% 
  add_and()
```


Finally, the indicators at the top of the chart show the best country coverage over time. They are characterized by their bright yellow color. For example `r hcex` show remarkable coverage. The table below shows the `r nrow(hc)` indicators with high coverage.


```{r hcdt}
hc %>% 
  DT::datatable(
    colnames = c("Code", "Indicator", "Sector"),
    rownames = FALSE,
    filter = 'top', 
    width = '55%', 
    extensions = 'FixedColumns',
    options = list(pageLength = 6, 
                   autowidth = TRUE)
  ) 
```


