# Coverage Analysis {#coverage}

```{r setupcoverage, echo=FALSE, message=FALSE, warning=FALSE}
#--------- execute script of analysis
source("R/load_data.R")
source("R/esg_availability.R")
```


The availability of ESG indicators by country is dynamic over time. As shown in Figure \@ref(fig:ciavailability), not all indicators are available in all countries neither they are available in all years. The availability of indicators goes from darker to lighter. The lighter the color the more the greater the number of countries per indicator in each year. Several insights are drawn from this chart. 

```{r ciavailability, fig.width = 12, fig.height = 10, fig.cap = "Number of countries per indicator over time"}
pg1
```

The characteristics of ESG indicators coverage vary significantly across the study area, 
but can be classified under one of five different patterns:

*TGH: a couple of overall observations on 2.1 - 2.5. 1) the study period has changed (now starts at 2000) and the text hasn't really been updated to reflect
that. Need to accordingly review and revise summary stats as well as description in 2.1; 2) I'm not sure 2.2 is relevant any more; 3) 2.4
is the most important category since this is how we define "data gap" in the introduction, so let's underscore that point; 4) can we
add a complete list of indicators for each section to help quantify the analysis? 5) 2.5 (high coverage) corresponds to "no gaps" classification
in the next section so let's make that point and make sure the indicators align.*


## Low coverage

```{r echo = FALSE}
tr_low <- 100  # number of countries. 
d3 <- d2  %>%
  mutate(max = max(mean),
         less = (mean < tr_low)) %>%
  summarise(sless = sum(less),
            max = mean(max),
            s   = sless/max)
d4 <- d2 %>% 
  filter(mean < tr_low)


```

Some indicators have very low availability over time. In general, `r d3[["sless"]]` (`r round(100*d3[["s"]],2)`%) indicators are available for less than `r tr_low` countries in average over time. Yet, not all indicators with low coverage have the same characteristics. For instance, 

```{r dtlc, options}
d4 %>% 
  arrange(mean) %>% 
  DT::datatable(
    colnames = c("Code", "Indicator", "Average of countries per year"),
    rownames = FALSE,
    filter = 'top', 
    width = '55%', 
    extensions = 'FixedColumns',
    options = list(pageLength = 5)
  ) %>% 
  DT::formatRound("mean" , 1)

```


## Remarkable improvement over time

There are a few indicators that show a remarkable improvement in country coverage over time. Indicators that come from household surveys such as the _Poverty headcounts_ or _Gini index_ have shown a dramatic improvement in country coverage in the beginning of the 2000's. The table below shows the average growth of number of countries in each indicator. The higher the number the more consistent has been the indicator on adding country coverage since 2000.   

```{r agcbi}
lmdi %>% 
  DT::datatable(
    colnames = c("Code", "Indicator", "Avg. growth of No. of countries"),
    rownames = FALSE,
    filter = 'top', 
    width = '55%', 
    extensions = 'FixedColumns',
    options = list(pageLength = 5)
  ) %>% 
  DT::formatRound("beta" , 1)
```



## Remain stable over time but with middle coverage

```{r fullystind}
fsi <- si %>% 
  filter(sd == 0) %>% 
  count() %>% 
  pull()


avfsi <- si %>% 
  filter(sd == 0) %>% 
  summarise(mm = mean(mean, na.rm = TRUE)) %>% 
  pull()

cfsi <- si %>% 
  filter(sd == 0) %>% 
  distinct(indicator) %>% 
  pull() %>% 
  add_and()

```

The country coverage of some indicators have remained relatively stable over time. Only `r fsi` indicators have not changed their country coverage over the period of analysis. In average, they cover `r round(avfsi, digit = 1)` countries.  These indicators are `r cfsi`. 

The table below shows how stable each indicator is over time and the average number of countries covered in each year.  

```{r dtsi}
si %>% 
  DT::datatable(
    colnames = c("Code", "Indicator", "Avg. of countries", "Standard Dev."),
    rownames = FALSE,
    filter = 'top', 
    width = '55%', 
    extensions = 'FixedColumns',
    options = list(pageLength = 5)
  ) %>% 
  DT::formatRound("mean" , 1) %>% 
  DT::formatRound("sd" , 2) 
```

## High coverage and sudden decline

Most recent value (MRV) of most indicators is two or more years old. However, some indicators with remarkable good coverage in the previous decade suddenly declined in the last five years. The table below shows the year in which the country coverage of each indicator plummeted and the number countries that were dropped. 

```{r sdd}
sdd %>% 
  DT::datatable(
    colnames = c("Code", "Indicator", "Year", "No. Countries dropped"),
    rownames = FALSE,
    filter = 'top', 
    width = '55%', 
    extensions = 'FixedColumns',
    options = list(pageLength = 5)
  ) 
```


## high coverage 

Finally, the indicators at the right side of the chart present the best country coverage over time. They are characterized by their intense blue color. For instance, _Population density_, _Adjusted savings: mineral depletion_, or _Land area_ have a remarkable and stable high country coverage. 


