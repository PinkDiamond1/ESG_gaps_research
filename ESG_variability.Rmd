# Variability Analysis

```{r setupvariability, echo=FALSE, message=FALSE, warning=FALSE}
#--------- execute script of analysis
source("R/load_data.R")
source("R/esg_availability.R")
source("R/esg_variability.R")
```

ESG indicators belong to set of measures of wide diversity. Some of them are estimated every few years, whereas others are produced every three or six month. In addition, some indicators are bounded by construction---like percentages or indexes---, others are normalized across countries--like indicators in PPP values--, others are in units based on population size---like all the indicators of the type, *x by 1,000 people*---, among many other kinds of measures and units. This variety makes it difficult to compare directly one indicator to another, especially if some or all the indicators are weighted in any particular fashion. 

To alleviate this problem, a standard measure of volatility could be applied to all indicators. Those indicators that vary the most, deserve the most attention by investors, whereas those that vary the less could be revisited every few years to recalibrate models.  To make volatility comparable across countries, it was necessary to rescale all indicators and linearly interpolate missing values by year. Then, the coefficient of variation (CV) was estimated at indicator/country level in order to capture  temporal volatility of each indicator at the country level, which is represented in Figure \@ref(fig:civar). 

```{r civar, echo=FALSE, message=FALSE, warning=FALSE, fig.cap = "Coefficient of variation by country and indicators", fig.fullwidth = TRUE, fig.width = 14, fig.height = 8}
pg2
```

Figure \@ref(fig:civar) presents a great amount of information. It allwos the user to visualize for, all the countries, which indicators have the highest or lower volatilities, and apot, if any, countries that have outlier values in particular indicators. However, since the volatility of each indicator across countries is not the same for all countries, Figure \@ref(fig:civar) is not the best tool to find the dispersion of volatility of each indicator across all countries. The range volatility of some indicators is large, whereas in other is low. For instance, the coefficient of variation of _`r diff_ind[["ind_name"]][1]`_ varies from `r round(diff_ind[["min"]][1], 2)` in `r diff_ind[["min_cty"]][1]` to `r round(diff_ind[["max"]][1], 2)` in `r diff_ind[["max_cty"]][1]`. Also, the coefficient of variation of _`r diff_ind[["ind_name"]][2]`_ varies from `r round(diff_ind[["min"]][2], 2)` in `r diff_ind[["min_cty"]][2]` to `r round(diff_ind[["max"]][2], 2)` in `r diff_ind[["max_cty"]][2]`. Finally, the coefficient of variation of _`r diff_ind[["ind_name"]][3]`_ varies from `r round(diff_ind[["min"]][3], 2)` in `r diff_ind[["min_cty"]][3]` to `r round(diff_ind[["max"]][3], 2)` in `r diff_ind[["max_cty"]][3]`. Keep in mind that the CV of each indicator in each country does not reflect in any sense the level of the indicators but its volatility over time. Table \@ref(tab:high-range-cv) shows the highest and lowest value of the CV of each indicator and its corresponsing countries. It is organized from widest to norrowest range between highest CV and lowest CV. 

```{r diff-var, echo=FALSE, message=FALSE, warning=FALSE, fig.cap = "Range of coefficient of variation of indicators across countries", fig.margin = TRUE, fig.width = 6}

g_diff
```

```{r high-range-cv, echo = FALSE, fig.fullwidth = FALSE}

diff_ind %>%
  select(ind_name, max_cty, max, min_cty, min, diff) %>%
  datatable(colnames = c("Indicator", "Country", "Max", "Country", "Min", "Diff"),
            container = sketch,
            rownames = FALSE,
            filter = 'top', 
            extensions = 'FixedColumns',
            options = list(pageLength = 6,
                           autowidth = TRUE,
                           columnDefs = list(list(width = '50px', targets = c(2, 4, 5)),
                                              list(width = '100px', targets = c(1, 3)),
                                              list(width = '300px', targets = 0)
                           ),
                           scrollX = TRUE,
                           fixedColumns = TRUE)) %>%
  formatRound(c("max", "min", "diff") , 2)

# knitr::kable(high_diff_ind, 
#              caption = "Indicators with highest volatility range across countries", 
#              col.names = c("Indicator name", "highest CV", "lowest CV"))

```



In contrast to Figure \@ref(fig:civar), which presents detailed information of the volatility of each indicator at the country level, the average of CV across countries shows the overall volatility of each ESG indicators. Figure \@ref(fig:esg-var), shows the distribution of such estimates. 

```{r esg-var, echo=FALSE, message=FALSE, warning=FALSE, fig.cap = "Density of coefficient of variation of ESG indicators", fig.margin = TRUE, fig.width = 6}

g_cv
```

The average CV of most indicators (`r round(s_c_mid*100,1)`%) fall between `r round(q_cv[1],2)` and `r round(q_cv[2],2)`, which correspond to the 5th and 95th percentile of the average CV distribution. Since the CV is a relative measure of dispersion, a mean above (below) 1 conveys the idea that, in average, the ESG indicators have a relative high (low) volatility with respect to their own mean value. In this case, the overall mean is `r round(mean_cv, 2)`. 

Given that the majority of indicators are around the mean, all indicators have similar volatility. The light left tail of the distribution---those that fall below `r round(q_cv[1],2)` in CV---is composed by `r n_c_low` indicators (`r round(s_c_low*100,2)`%), whereas the right tail---those indicators that fall above `r round(q_cv[2],2)` in CV---is composed by `r n_c_high` indicators (`r round(s_c_high*100,2)`%). Table \@ref(tab:t-lh-cv) shows the indicators that fall in the left and right tail of the distribution. However, as it was shown in Figure \@ref(fig:civar), the distribution of average of CVs is an aggegation of CVs across countries over time. The CV distriutions of some indicators may have heavy tails and still their average might be close to the overall mean, convey the misconception fact that they are not as volatile as they really are.

```{r t-lh-cv, echo = FALSE}

knitr::kable(t_lh2, 
             caption = "ESG indicators with lowest and highest volatility", 
             col.names = c(lvarn, hvarn))

```

The first column of Table \@ref(tab:t-lh-cv) shows those indicators with low volatility. As expected, indicators like _`r t_lh2[[1,1]]`_, _`r t_lh2[[2,1]]`_, or _`r t_lh2[[3,1]]`_ do not change often and thus deserve little attention on a yearly basis for decision-investing processes. On the other hand, the right column of the table shows the most volatile indicators, whose standard deviations are two times higher than their means.




